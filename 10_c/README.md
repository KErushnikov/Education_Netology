
# Домашнее задание к занятию «Язык С и программные уязвимости»

В качестве результата пришлите ответы на вопросы в личном кабинете студента на сайте [netology.ru](https://netology.ru).

## Задание 1

**Важно**: выполняйте данную задачу на ОС Linux (Ubuntu или Kali)

### Легенда

У вас есть следующий код:
```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
int main() {
    /* выделяем буфер из 255 символов + \0 для хранения команды */
    char command[256] = {'p', 'i', 'n', 'g', ' ', '\0'};
    /* буфер для хранения хоста, который нужно пропинговать */
    char host[16];
    printf("please enter host for ping\n");
    /* получаем от пользователя имя хоста - нужно ввести в консоли, например, ya.ru и нажать Enter */
    gets(host);
    /* отладочный вывод - печатаем команду */
    printf("command: %s\n", command);
    /* отладочный вывод - печатаем хост */
    printf("host: %s\n", host);
    /* добавляем к команде хост, при этом \0 в команде заменяется на первый символ из host */
    strcat(command, host);
    /* отладочный вывод - печатаем полную команду */
    printf("full command: %s\n", command);
    /* выполняем команду */
    system(command);
    return 0;
}
```

*Важно*: строки, которые начинаются с `/*` и заканчиваются `*/` - это комментарии (пояснения к коду программы), вы можете их не печатать.

### Задача

По аналогии с лекцией установите необходимые зависимости (`apt update && apt install gcc`) и скомпилируйте данную программу (`cc main.c -o main`) - не обращайте внимание на предупреждения, если они будут.

Далее:
1\. Запустите её (`./main`), вы увидите приглашение вида:

![](pic/input.png)

2\. Введите адрес хоста, который необходимо пропинговать и убедитесь, что пинг работает:

![](pic/ping.png)

3\. Завершите работу приложения с помощью сочетания клавиш Ctrl + C

Творческая часть: попробуйте подобрать данные (по аналогии с лекцией) так, чтобы:
1. Приложение "упало" (вы получили сообщение segmentation fault или другое, свидетельствующее об ошибке)
1. Вам удалось выполнить вместо `ping` другую команду

<details>
<summary>Подсказка</summary>

Начните вводить по одному символу, пока не увидите, что команда `ping` вдруг заменилась на нужную вам (см. вывод `printf("full command: %s\n", command);`).
</details>

### Результаты

В качестве результата пришлите ответы на следующие вопросы:
1. Какое предупреждение (`Warning`) было выведено при компиляции? По желанию: проведите доп.исследование на предмет сути предупреждения (с чем оно связано, какие риски от использования одной из функций в программе и что это за функция).
1. Ввод, приводящий к падению приложения
1. Ввод, приводящий к выполнению другой команды (не `ping`)

В качестве результата пришлите ответы на вопросы в личном кабинете студента на сайте [netology.ru](https://netology.ru).

### Ответы:
1. warning: implicit declaration of function ‘gets’. warning: the `gets' function is dangerous and should not be used. Предупреждение о том, что функция gets() не безопасна из-за возможной реализации переполнения буфера и была удалена из стандарта C11, соответственно "there's no longer a prototype for gets() in <stdio.h>. gets() used to be in <stdio.h> use fgets() instead and take care of the trailing newline" об использовании более безопасной функции fgets() и информирует компилятор.
2. при вводе более 64 символов происходит segmentation fault
3. т.к под "host" выделено 16 символов, то после ввода 16 случайных символов можно вызвать любую команду, например echo, touch, mkdir и так далее. А еще можно просто ввести ;sh и получить доступ к консольному вводу скриптов bash

## Задание 2

**Важно**: выполняйте данную задачу на ОС Linux (Ubuntu или Kali)

### Легенда

Программисты прислали вам якобы "исправленный" вариант программы `ping`:
```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
int main() {
    /* выделяем буфер из 24 символов для хранения команды */
    char command[24] = "ping ";
    /* буфер для хранения хоста, который нужно пропинговать */
    char host[16];
    printf("please enter host for ping\n");
    /* получаем от пользователя имя хоста */
    /* нужно ввести в консоли, например, ya.ru и нажать Enter */
    fgets(host, sizeof(host), stdin);
    /* отладочный вывод - печатаем команду */
    printf("command: %s\n", command);
    /* отладочный вывод - печатаем хост */
    printf("host: %s\n", host);
    /* добавляем к команде хост, при этом \0 в команде заменяется на первый символ из host */
    strcat(command, host);
    /* отладочный вывод - печатаем полную команду */
    printf("full command: %s\n", command);
    /* выполняем команду */
    system(command);
    return 0;
}
```

### Задача

Проведите повторный анализ и посмотрите:
1. Можно ли реализовать переполнение?
1. Можно ли выполнить произвольную команду (если да, то как)?
1. Если ответ на п.2 - да, то можно ли получить shell (т.е. запустить `sh` и `bash` и продолжить работу с интерпретатором команд в интерактивном режиме)?

### Ответы:
1. Более нет предупреждения при компиляции, т.к. используется "безопасная" функция fgets(), в качестве аргумента у нее указано sizeof(host), т.е. ограничивает наш ввод 16 символами и реализовать переполнение, а соответственно и замену команды пинг через ввод более 16 символов у меня не удалось.
2. Да
3. ";sh" во втором коде так же прекрасно работает и дает возможность получить доступ к консольному вводу скриптов bash